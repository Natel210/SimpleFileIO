name: Env Check
description: Validate and display Git environment variables and provided file paths
inputs:
  config:
    description: JSON-encoded configuration for the action
    required: true
    default: "{}"

runs:
  using: "composite"
  steps:
    - name: Set SCRIPTS_DIR from Environment
      id: set_script_dir
      run: echo "SCRIPTS_DIR=${{ github.action_path }}/scripts" >> $GITHUB_ENV
      shell: bash

    # - name: Add Execute Permission for Scripts
    #   run: chmod +x $SCRIPTS_DIR/*.sh
    #   shell: bash

    # - name: Run File Check Script
    #   run: $SCRIPTS_DIR/exist-files.sh ${{ inputs.files }}
    #   shell: bash

    # - name: Remove Execute Permission for Scripts
    #   run: chmod -x $SCRIPTS_DIR/*.sh
    #   shell: bash

    - name: Parse JSON Config
    run: |
      echo "CONFIG=${{ inputs.config }}" >> $GITHUB_ENV
    shell: bash

    - name: Process Config with Bash
      run: |
        # Load CONFIG from $GITHUB_ENV
        CONFIG="${CONFIG:-{}}"
  
        # Debug: Print the received JSON
        echo "Received config: $CONFIG"
  
        # Parse JSON using jq
        solution_file=$(echo "$CONFIG" | jq -r '.solution_file')
        dll_file=$(echo "$CONFIG" | jq -r '.dll_file')
        tester_file=$(echo "$CONFIG" | jq -r '.tester_file')
  
        # Display parsed values
        echo "Solution File: $solution_file"
        echo "DLL File: $dll_file"
        echo "Tester File: $tester_file"
      shell: bash
  
    - name: Clean Up Environment Variables
      run: |
        # Remove CONFIG from $GITHUB_ENV
        sed -i '/^CONFIG=/d' $GITHUB_ENV
      shell: bash


    - name: Remove SCRIPTS_DIR from Environment
      run: echo "SCRIPTS_DIR=" >> $GITHUB_ENV
      shell: bash

    - name: Unset SCRIPTS_DIR in Current Session
      run: unset SCRIPTS_DIR
      shell: bash
